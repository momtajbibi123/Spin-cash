
<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Support Chat</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#eecd2b",
                    "background-light": "#f8f8f6",
                    "background-dark": "#181711",
                },
                fontFamily: {
                    "display": ["Spline Sans", "sans-serif"]
                },
                borderRadius: {
                    "DEFAULT": "1rem",
                    "lg": "2rem",
                    "xl": "3rem",
                    "full": "9999px"
                },
            },
        },
    }
</script>
<style>
    body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        min-height: 100dvh;
    }
    @keyframes typing {
        0% { content: '.'; }
        33% { content: '..'; }
        66% { content: '...'; }
        100% { content: '.'; }
    }
    .typing::after {
        content: '.';
        animation: typing 1.5s infinite;
    }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="relative flex h-screen w-full flex-col group/design-root overflow-hidden">
    <div class="flex items-center p-4 pb-2 justify-between shrink-0 bg-background-light dark:bg-background-dark">
        <button onclick="window.location.href='home.html'" class="text-gray-900 dark:text-white flex size-12 shrink-0 items-center justify-center">
            <span class="material-symbols-outlined">arrow_back_ios_new</span>
        </button>
        <h2 class="text-gray-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">Game Assistant</h2>
        <div class="w-12"></div>
    </div>
    <div id="chat-container" class="flex-1 overflow-y-auto px-4 pt-2 pb-4 space-y-4">
        <!-- Initial Bot Message -->
        <div class="flex items-start gap-3">
            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full w-10 shrink-0" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuC3NejJRgLWe0L13dtxO-14xi4Kc2yNhIqMJEJHAzslXGVeetqoKE0j2SQvOQwQjUe8Jt8aoCEc86bEpBnQaaMrQ2ZNmGyExYNHMqAocAR5BZfNIqCNkiB7P7egOvcL2Kw9v40Xjnb63soD8p1WU0dpDnpfbtDpT9zlK7sTerUk2MG7ZnJSDAvk3yVhqvL_fcuT_kMKKd4FxqQdHcjnpGWxQWfAXbhYHOXFYgJNbn8n9V9vbIBPA3FuRiGqMBxIMuODd_E6JDbgM6w");'></div>
            <div class="flex flex-1 flex-col gap-2 items-start">
                <p class="text-gray-500 dark:text-[#b9b49d] text-[13px] font-normal leading-normal max-w-[360px]">Game Assistant</p>
                <div class="space-y-2">
                    <p class="text-base font-normal leading-normal flex max-w-[360px] rounded-xl px-4 py-3 bg-gray-200 dark:bg-[#393628] text-gray-900 dark:text-white">
                        Hello! I'm your Game Assistant. How can I help you today?
                    </p>
                    <p class="text-base font-normal leading-normal flex max-w-[360px] rounded-xl px-4 py-3 bg-gray-200 dark:bg-[#393628] text-gray-900 dark:text-white">
                        Please choose from the options below.
                    </p>
                </div>
                <div id="option-buttons" class="grid grid-cols-1 @[240px]:grid-cols-2 gap-2 mt-2 w-full max-w-[360px]">
                    <button class="option-btn text-base font-medium leading-normal flex items-center justify-center text-center rounded-xl px-4 py-3 bg-gray-200 dark:bg-[#393628] text-gray-900 dark:text-white">Withdrawal Problem</button>
                    <button class="option-btn text-base font-medium leading-normal flex items-center justify-center text-center rounded-xl px-4 py-3 bg-gray-200 dark:bg-[#393628] text-gray-900 dark:text-white">Point Problem</button>
                    <button class="option-btn text-base font-medium leading-normal flex items-center justify-center text-center rounded-xl px-4 py-3 bg-gray-200 dark:bg-[#393628] text-gray-900 dark:text-white">Balance Problem</button>
                    <button class="option-btn text-base font-medium leading-normal flex items-center justify-center text-center rounded-xl px-4 py-3 bg-gray-200 dark:bg-[#393628] text-gray-900 dark:text-white">Login Problem</button>
                    <button class="option-btn text-base font-medium leading-normal flex items-center justify-center text-center rounded-xl px-4 py-3 bg-gray-200 dark:bg-[#393628] text-gray-900 dark:text-white">Others</button>
                </div>
            </div>
        </div>
    </div>
    <div class="flex items-start px-4 py-3 gap-3 @container bg-background-light dark:bg-background-dark shrink-0">
        <label class="flex flex-col min-w-40 flex-1">
            <div class="flex w-full flex-1 items-stretch rounded-xl">
                <textarea id="message-input" class="form-textarea flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-gray-900 dark:text-white focus:outline-0 focus:ring-0 border-none bg-gray-200 dark:bg-[#393628] focus:border-none placeholder:text-gray-500 dark:placeholder:text-[#b9b49d] px-4 py-3 text-base font-normal leading-normal" placeholder="Write your message..." rows="1"></textarea>
            </div>
        </label>
        <button id="send-btn" class="flex items-center justify-center shrink-0 size-12 cursor-pointer overflow-hidden rounded-full bg-primary text-gray-900 dark:text-[#181711]">
            <span class="material-symbols-outlined">send</span>
        </button>
    </div>
</div>

<script>
    // --- Firebase Configuration ---
    const firebaseConfig = {
        apiKey: "AIzaSyBQHKJvI_FBqClddSho75Xz6w4vjXbt_w0",
        authDomain: "spin-and-win-d4217.firebaseapp.com",
        databaseURL: "https://spin-and-win-d4217-default-rtdb.firebaseio.com",
        projectId: "spin-and-win-d4217",
        storageBucket: "spin-and-win-d4217.firebasestorage.app",
        messagingSenderId: "1000691452468",
        appId: "1:1000691452468:web:723e6e050faf6423e99861"
    };

    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();
    const userId = localStorage.getItem('loggedInUserId');
    if (!userId) { window.location.href = "login.html"; }

    const chatContainer = document.getElementById('chat-container');
    const messageInput = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');
    const optionButtonsContainer = document.getElementById('option-buttons');

    function sendMessage(messageText) {
        if (!messageText.trim()) return;

        const messageData = {
            userId: userId,
            message: messageText,
            timestamp: new Date().toISOString()
        };

        database.ref('contact/messages').push(messageData)
            .then(() => {
                displayUserMessage(messageText);
                messageInput.value = '';
                getAutoReply(messageText);
            })
            .catch(error => {
                console.error("Error sending message:", error);
                alert("Failed to send message.");
            });
    }

    function displayUserMessage(messageText) {
        const userMessageHTML = `
            <div class="flex items-start justify-end gap-3">
                <div class="flex flex-1 flex-col gap-1 items-end">
                    <p class="text-base font-normal leading-normal flex max-w-[360px] rounded-xl px-4 py-3 bg-primary text-gray-900 dark:text-[#181711]">
                        ${messageText}
                    </p>
                </div>
            </div>`;
        chatContainer.insertAdjacentHTML('beforeend', userMessageHTML);
        scrollToBottom();
    }

    function displayBotMessage(messageText) {
        const botMessageHTML = `
            <div class="flex items-start gap-3">
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full w-10 shrink-0" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuC3NejJRgLWe0L13dtxO-14xi4Kc2yNhIqMJEJHAzslXGVeetqoKE0j2SQvOQwQjUe8Jt8aoCEc86bEpBnQaaMrQ2ZNmGyExYNHMqAocAR5BZfNIqCNkiB7P7egOvcL2Kw9v40Xjnb63soD8p1WU0dpDnpfbtDpT9zlK7sTerUk2MG7ZnJSDAvk3yVhqvL_fcuT_kMKKd4FxqQdHcjnpGWxQWfAXbhYHOXFYgJNbn8n9V9vbIBPA3FuRiGqMBxIMuODd_E6JDbgM6w");'></div>
                <div class="flex flex-1 flex-col gap-2 items-start">
                    <p class="text-gray-500 dark:text-[#b9b49d] text-[13px] font-normal">Game Assistant</p>
                    <p class="text-base font-normal leading-normal flex max-w-[360px] rounded-xl px-4 py-3 bg-gray-200 dark:bg-[#393628] text-gray-900 dark:text-white">
                        ${messageText}
                    </p>
                </div>
            </div>`;
        chatContainer.insertAdjacentHTML('beforeend', botMessageHTML);
        scrollToBottom();
    }
    
    function showTypingIndicator() {
        const typingHTML = `
            <div class="flex items-start gap-3" id="typing-indicator">
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full w-10 shrink-0" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuC3NejJRgLWe0L13dtxO-14xi4Kc2yNhIqMJEJHAzslXGVeetqoKE0j2SQvOQwQjUe8Jt8aoCEc86bEpBnQaaMrQ2ZNmGyExYNHMqAocAR5BZfNIqCNkiB7P7egOvcL2Kw9v40Xjnb63soD8p1WU0dpDnpfbtDpT9zlK7sTerUk2MG7ZnJSDAvk3yVhqvL_fcuT_kMKKd4FxqQdHcjnpGWxQWfAXbhYHOXFYgJNbn8n9V9vbIBPA3FuRiGqMBxIMuODd_E6JDbgM6w");'></div>
                <div class="flex flex-1 flex-col gap-2 items-start">
                    <p class="text-gray-500 dark:text-[#b9b49d] text-[13px] font-normal">Game Assistant</p>
                    <p class="text-base font-normal leading-normal flex max-w-[360px] rounded-xl px-4 py-3 bg-gray-200 dark:bg-[#393628] text-gray-900 dark:text-white typing">
                    </p>
                </div>
            </div>`;
        chatContainer.insertAdjacentHTML('beforeend', typingHTML);
        scrollToBottom();
    }

    function removeTypingIndicator() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) {
            indicator.remove();
        }
    }

    function getAutoReply(userMessage) {
        showTypingIndicator();
        database.ref('contact/Auto').once('value', (snapshot) => {
            const autoReplies = snapshot.val();
            let reply = "Thank you for your message. We will get back to you soon."; // Default reply
            
            if (autoReplies && autoReplies[userMessage]) {
                reply = autoReplies[userMessage];
            }
            
            setTimeout(() => {
                removeTypingIndicator();
                displayBotMessage(reply);
            }, 1500); // Simulate bot thinking time
        });
    }

    function scrollToBottom() {
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    sendBtn.addEventListener('click', () => sendMessage(messageInput.value));
    messageInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            sendMessage(messageInput.value);
        }
    });

    const optionButtons = optionButtonsContainer.querySelectorAll('.option-btn');
    optionButtons.forEach(button => {
        button.addEventListener('click', () => {
            const message = button.textContent.trim();
            sendMessage(message);
        });
    });

</script>
</body>
</html>
```
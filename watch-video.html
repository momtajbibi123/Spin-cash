
<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Watch & Earn</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<!-- Canvas Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<script>
    tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#ee9d2b",
              "background-dark": "#121212",
              "card-dark": "#1E1E1E",
            },
            fontFamily: {
              "display": ["Plus Jakarta Sans", "sans-serif"]
            },
          },
        },
      }
</script>
<style>
    .material-symbols-outlined {
        font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    body {
      min-height: 100vh;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }
    .video-banner {
        position: relative; width: 100%; height: 200px;
        border-radius: 20px; overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        background-image: url('https://img.freepik.com/free-vector/streaming-service-concept-illustration_114360-1285.jpg');
        background-size: cover; background-position: center;
    }
    .play-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.4); display: flex;
        align-items: center; justify-content: center; transition: background 0.3s;
    }
    .play-icon {
        width: 60px; height: 60px;
        background: rgba(255,255,255,0.2); backdrop-filter: blur(5px);
        border-radius: 50%; display: flex; align-items: center;
        justify-content: center; border: 2px solid white; animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
        70% { box-shadow: 0 0 0 15px rgba(255, 255, 255, 0); }
        100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
    }
    .video-ad-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: black; z-index: 100; display: none;
        flex-direction: column; align-items: center; justify-content: center;
    }
    .video-ad-overlay.active { display: flex; }
    .video-container {
        width: 100%; height: 100%; display: flex;
        justify-content: center; align-items: center; background: black;
    }
    .video-container video { width: 100%; height: auto; max-height: 100vh; }
    .dialog-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
        display: none; justify-content: center; align-items: center;
        z-index: 50; opacity: 0; transition: opacity 0.3s ease;
    }
    .dialog-overlay.open { display: flex; opacity: 1; }
    .dialog-box {
        background: #1E1E1E; border: 1px solid #333;
        width: 90%; max-width: 320px; padding: 30px;
        border-radius: 24px; text-align: center; transform: scale(0.8);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }
    .dialog-overlay.open .dialog-box { transform: scale(1); }
</style>
</head>
<body class="bg-background-dark text-white flex flex-col">

    <!-- Header -->
    <div class="flex items-center p-4 sticky top-0 bg-[#121212] z-10 border-b border-white/5">
        <div class="flex size-12 shrink-0 items-center justify-start cursor-pointer" onclick="window.location.href='home.html'">
            <span class="material-symbols-outlined text-white">arrow_back</span>
        </div>
        <h1 class="text-white text-lg font-bold flex-1 text-center">Watch & Earn</h1>
        <div class="flex items-center justify-end space-x-2">
            <div class="flex items-center gap-2 rounded-full bg-amber-400/10 px-3 py-1.5 border border-amber-500/50">
                <span class="material-symbols-outlined text-amber-400">monetization_on</span>
                <p id="header-coins" class="text-white text-base font-bold">0</p>
            </div>
            <div class="flex items-center gap-2 rounded-full bg-[#1E1E1E] px-3 py-1.5 border border-[#333]">
                <span class="material-symbols-outlined text-[#FFD700]">account_balance_wallet</span>
                <p id="header-balance" class="text-white text-base font-bold">₹0</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col items-center p-6 w-full max-w-md mx-auto">
        <div class="video-banner mb-6" onclick="playVideo()">
            <div class="play-overlay">
                <div class="play-icon">
                    <span class="material-symbols-outlined text-white text-4xl">play_arrow</span>
                </div>
            </div>
        </div>
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold text-white mb-2">Watch Video Ads</h2>
            <p class="text-gray-400 text-sm">Click the button below to watch a short video and earn coins instantly!</p>
        </div>
        <button onclick="playVideo()" class="w-full py-4 rounded-xl bg-gradient-to-r from-[#ee9d2b] to-[#ff6f00] text-white font-bold text-lg shadow-lg shadow-primary/30 hover:brightness-110 active:scale-95 transition-all flex items-center justify-center gap-2">
            <span class="material-symbols-outlined">smart_display</span>
            WATCH VIDEO
        </button>

        <!-- Adsterra Banner Ad -->
        <div class="w-full flex justify-center items-center mt-auto pt-6">
            <script type="text/javascript">
                atOptions = {
                    'key' : '8d8ed01dbfb159ca9bb482d1dc52a43b',
                    'format' : 'iframe',
                    'height' : 90,
                    'width' : 728,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/8d8ed01dbfb159ca9bb482d1dc52a43b/invoke.js"></script>
        </div>
    </div>

    <!-- Video Ad Overlay -->
    <div id="video-ad" class="video-ad-overlay">
        <div class="video-container">
            <video id="ad-video-player" controls autoplay loop muted playsinline>
                <source src="video1.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>
        <div class="absolute top-4 right-4 bg-black/50 px-3 py-1 rounded-full text-sm">
            Reward in <span id="countdown">5</span>s
        </div>
    </div>

    <!-- Reward Dialog -->
    <div class="dialog-overlay" id="reward-dialog">
        <div class="dialog-box">
            <div class="flex justify-center mb-4">
                <span class="material-symbols-outlined text-6xl text-[#FFD700] animate-bounce">redeem</span>
            </div>
            <h2 class="text-2xl font-bold text-white mb-2">Reward Earned!</h2>
            <p class="text-[#A0A0A0] mb-6">You have received</p>
            <div id="reward-text" class="text-4xl font-extrabold text-[#FFD700] mb-6">
                +0 Coins
            </div>
        </div>
    </div>

    <audio id="reward-sound" src="watc.mp3" preload="auto"></audio>

<script>
    // --- Firebase Config ---
    const firebaseConfig = {
        apiKey: "AIzaSyBQHKJvI_FBqClddSho75Xz6w4vjXbt_w0",
        authDomain: "spin-and-win-d4217.firebaseapp.com",
        databaseURL: "https://spin-and-win-d4217-default-rtdb.firebaseio.com",
        projectId: "spin-and-win-d4217",
        storageBucket: "spin-and-win-d4217.firebasestorage.app",
        messagingSenderId: "1000691452468",
        appId: "1:1000691452468:web:723e6e050faf6423e99861"
    };

    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const database = firebase.database();
    const userId = localStorage.getItem('loggedInUserId');
    if (!userId) { window.location.href = "login.html"; }

    // --- Elements ---
    const headerBalance = document.getElementById('header-balance');
    const headerCoins = document.getElementById('header-coins');
    const videoAd = document.getElementById('video-ad');
    const videoPlayer = document.getElementById('ad-video-player');
    const countdownEl = document.getElementById('countdown');
    const rewardDialog = document.getElementById('reward-dialog');
    const rewardText = document.getElementById('reward-text');
    const rewardSound = document.getElementById('reward-sound');

    // --- Config ---
    const coinsNeededForOneRupee = 100;
    let isWatching = false;

    // --- Initialize ---
    function init() {
        loadUserData();
    }

    // --- Load User Data ---
    function loadUserData() {
        const userRef = database.ref(`users/${userId}`);
        userRef.on('value', (snap) => {
            const userData = snap.val() || {};
            headerCoins.innerText = (userData.Coin || 0).toLocaleString();
            headerBalance.innerText = "₹" + (parseFloat(userData.balance) || 0).toFixed(2);
        });
    }

    // --- Play Video Logic ---
    function playVideo() {
        if (isWatching) return;
        isWatching = true;

        rewardSound.muted = true;
        rewardSound.play().then(() => {
            rewardSound.pause();
            rewardSound.currentTime = 0;
            rewardSound.muted = false; 
        }).catch(e => console.log("Audio unlock failed:", e));
        
        videoAd.classList.add('active');
        videoPlayer.currentTime = 0;
        videoPlayer.play();
        
        let timeLeft = 5;
        countdownEl.innerText = timeLeft;

        const interval = setInterval(() => {
            timeLeft--;
            countdownEl.innerText = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(interval);
                finishVideo();
            }
        }, 1000);
    }

    // --- Finish Video & Give Reward ---
    function finishVideo() {
        videoAd.classList.remove('active');
        videoPlayer.pause();
        isWatching = false;
        
        const randomCoinsWon = Math.floor(Math.random() * 10) + 1;

        rewardText.innerText = `+${randomCoinsWon} Coins`;
        rewardDialog.classList.add('open');
        
        rewardSound.currentTime = 0;
        rewardSound.play().catch(e => console.log("Audio play failed:", e));
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#FFD700', '#ffffff'] });

        if (userId) {
            const userRef = database.ref(`users/${userId}`);
            
            userRef.transaction((currentUserData) => {
                if (currentUserData) {
                    let currentCoins = parseInt(currentUserData.Coin) || 0;
                    let currentBalance = parseFloat(currentUserData.balance) || 0;
                    
                    currentCoins += randomCoinsWon;
                    
                    if (currentCoins >= coinsNeededForOneRupee) {
                        const rupeesToAdd = Math.floor(currentCoins / coinsNeededForOneRupee);
                        currentBalance += rupeesToAdd;
                        currentCoins %= coinsNeededForOneRupee; // use modulo to keep the remainder
                    }
                    
                    currentUserData.Coin = currentCoins;
                    currentUserData.balance = currentBalance;
                }
                return currentUserData;
            });
        }

        setTimeout(() => {
            rewardDialog.classList.remove('open');
        }, 3000);
    }

    init();

</script>
</body>
</html>